@using Jhooa.UI.Resources
@using Microsoft.Extensions.Localization
@using Jhooa.UI.Features.Localization.Components

@implements IDisposable

@inject IStringLocalizer<Shared> Loc
@inject NavigationManager NavigationManager

<header class="w-full bg-black">
    <div class="max-w-screen-xl mx-auto px-4 py-2 flex items-center text-white">
        <div class="flex items-center space-x-2">
            <!-- Arrow Icon -->
            <a href="/" class="focus:outline-none mr-2 flex items-center">
                <svg
                    class="h-5 w-5"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    viewBox="0 0 24 24"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path d="M10 19l-7-7 7-7"/>
                    <path d="M3 12h18"/>
                </svg>
            </a>
            <a href="/" class="text-sm hover:underline hidden md:inline-block">
                @Loc["BackToHome"]
            </a>
        </div>

        <!-- Center Section: Logo -->
        <div class="flex-1 flex justify-center">
            <!-- Replace with your actual logo or brand name -->
            <h1 class="text-2xl font-semibold tracking-wide">
                <img src="images/logo.svg" alt="Jhooa" class="h-12"/>
            </h1>
        </div>

        <!-- Right Section: Button + Language Selector -->
        <div class="flex items-center space-x-4">
            <!-- Connexion Button -->
            <AuthorizeView>
                <Authorized>
                    
                    <form action="Account/Logout" method="post">
                        <AntiforgeryToken/>
                        <input type="hidden" name="ReturnUrl" value="@_currentUrl"/>
                        <button type="submit" class="nav-link underline">
                            @Loc["Logout"]
                        </button>
                    </form>
                </Authorized>
                <NotAuthorized>
                    <a href="/Account/Login"
                       class="bg-[#CE8672] hover:bg-opacity-80 text-white py-2 px-4 rounded flex items-center focus:outline-none"
                    >
                        <!-- User Icon -->
                        <svg
                            class="h-4 w-4 mr-2"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            viewBox="0 0 24 24"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        >
                            <path d="M16 21v-2a4 4 0 00-8 0v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        @Loc["Login"]
                    </a>
                </NotAuthorized>
            </AuthorizeView>


            <!-- Language Selector -->
            <div class="relative">
                <CultureSelector @rendermode="InteractiveServer"/>
            </div>
        </div>
    </div>
</header>

<AuthorizeView>
<Authorized>

    <ManageNavMenu/>

</Authorized>
</AuthorizeView>

@code {
    private string? _currentUrl;

    protected override void OnInitialized()
    {
        _currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        _currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }

}