@using Microsoft.Extensions.Localization
@inject NavigationManager Navigation
@inject IStringLocalizer<CultureSelector> Loc

<InputSelect id="language" @bind-Value="_selectedCulture"
             class="text-white bg-transparent border-0 md:inline-block md:float-end md:mx-5 focus:border-0 active:border-0">
    <option value="fr-FR" @onclick='(() => ApplySelectedCultureAsync(new CultureInfo("fr-FR")))'>FR</option>
    <option value="en-GB" @onclick='(() => ApplySelectedCultureAsync(new CultureInfo("en-GB")))'>EN</option>
</InputSelect>


@code
{
    private CultureInfo _selectedCulture = CultureInfo.CurrentCulture;

    private Task ApplySelectedCultureAsync(CultureInfo culture)
    {
        if (Equals(CultureInfo.CurrentCulture, culture))
            return Task.CompletedTask;

        var uri = new Uri(Navigation.Uri)
            .GetComponents(UriComponents.PathAndQuery, UriFormat.Unescaped);
        var cultureEscaped = Uri.EscapeDataString(culture.Name);
        var uriEscaped = Uri.EscapeDataString(uri);

        Navigation.NavigateTo(
            $"Culture/Set?culture={cultureEscaped}&redirectUri={uriEscaped}",
            forceLoad: true);

        return Task.CompletedTask;
    }
}